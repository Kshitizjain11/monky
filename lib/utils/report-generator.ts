import type { DebugSession, SessionReport } from "@/lib/types/session-reports"

export function generateSessionReport(session: DebugSession, language: "english" | "hindi" = "english"): SessionReport {
  const langText = language === "english"

  const keyLearnings = []
  if (session.errorType.includes("Type"))
    keyLearnings.push(langText ? "Understanding type safety and operations" : "Type safety à¤”à¤° operations à¤•à¥‹ à¤¸à¤®à¤à¤¨à¤¾")
  if (session.errorType.includes("Reference"))
    keyLearnings.push(langText ? "Variable scope and declaration" : "Variable scope à¤”à¤° declaration")
  if (session.errorType.includes("Loop"))
    keyLearnings.push(langText ? "Loop conditions and control flow" : "Loop conditions à¤”à¤° control flow")

  const nextSteps = []
  if (session.complexity === "High")
    nextSteps.push(
      langText
        ? "Practice breaking complex problems into smaller steps"
        : "Complex problems à¤•à¥‹ à¤›à¥‹à¤Ÿà¥‡ steps à¤®à¥‡à¤‚ break à¤•à¤°à¤¨à¥‡ à¤•à¤¾ practice à¤•à¤°à¥‡à¤‚",
    )
  nextSteps.push(
    langText
      ? "Review similar error patterns from past sessions"
      : "à¤ªà¤¿à¤›à¤²à¥€ debugging sessions à¤¸à¥‡ similar patterns review à¤•à¤°à¥‡à¤‚",
  )

  return {
    session,
    summary: langText
      ? `You debugged a ${session.complexity.toLowerCase()} complexity ${session.language} code and fixed a ${session.errorType}.`
      : `à¤†à¤ªà¤¨à¥‡ à¤à¤• ${session.complexity.toLowerCase()} complexity ${session.language} code à¤•à¥‹ debug à¤•à¤¿à¤¯à¤¾ à¤”à¤° ${session.errorType} à¤•à¥‹ fix à¤•à¤¿à¤¯à¤¾à¥¤`,
    keyLearnings:
      keyLearnings.length > 0
        ? keyLearnings
        : [langText ? "Code debugging fundamentals" : "Code debugging à¤•à¥‡ fundamentals"],
    nextSteps,
    complexityAnalysis: {
      current: session.complexity,
      explanation: langText
        ? "Review your code structure and consider refactoring if needed"
        : "à¤…à¤ªà¤¨à¥‡ code structure à¤•à¥‹ review à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤œà¤¼à¤°à¥‚à¤°à¤¤ à¤ªà¤¡à¤¼à¤¨à¥‡ à¤ªà¤° refactor à¤•à¤°à¥‡à¤‚",
    },
  }
}

export function generateDownloadableReport(report: SessionReport, language: "english" | "hindi" = "english"): string {
  const langText = language === "english"

  const markdown = `# ${langText ? "Debug Session Report" : "Debug Session Report"}
Date: ${report.session.timestamp.toLocaleDateString()}

## Summary
${report.summary}

## Error Details
- **Error Type**: ${report.session.errorType}
- **Language**: ${report.session.language}
- **Complexity**: ${report.session.complexity}
- **Time Spent**: ${Math.round(report.session.timeSpent / 60)} minutes

## Key Learnings
${report.keyLearnings.map((learning) => `- ${learning}`).join("\n")}

## Next Steps
${report.nextSteps.map((step) => `- ${step}`).join("\n")}

## Code Analysis
### Original Code
\`\`\`
${report.session.code}
\`\`\`

### Complexity Analysis
${report.complexityAnalysis.explanation}

---
Generated by CodeTutor | Keep learning, keep growing!
`

  return markdown
}

export function checkAchievements(
  totalSessions: number,
  totalErrors: number,
): { title: string; description: string; icon: string }[] {
  const achievements = []

  if (totalSessions === 1)
    achievements.push({
      title: "First Debug",
      description: "Complete your first debugging session",
      icon: "ðŸš€",
    })
  if (totalSessions === 5)
    achievements.push({
      title: "Debugger",
      description: "Complete 5 debugging sessions",
      icon: "ðŸ”§",
    })
  if (totalSessions === 10)
    achievements.push({
      title: "Master Debugger",
      description: "Complete 10 debugging sessions",
      icon: "ðŸŽ¯",
    })
  if (totalErrors >= 5)
    achievements.push({
      title: "Error Solver",
      description: "Fix 5 different types of errors",
      icon: "ðŸ’¡",
    })

  return achievements
}
